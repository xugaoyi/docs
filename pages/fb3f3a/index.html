<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deepin 开发任务栏网速插件 lfxSpeed | Documentation</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Deepin Documentation">
    <link rel="preload" href="/assets/css/0.styles.bc4b65ce.css" as="style"><link rel="preload" href="/assets/js/app.fc02f5f4.js" as="script"><link rel="preload" href="/assets/js/2.ed4cc2e0.js" as="script"><link rel="preload" href="/assets/js/52.9884a8fd.js" as="script"><link rel="prefetch" href="/assets/js/10.86575e39.js"><link rel="prefetch" href="/assets/js/11.d85b8aec.js"><link rel="prefetch" href="/assets/js/12.b4a78faa.js"><link rel="prefetch" href="/assets/js/13.248879fa.js"><link rel="prefetch" href="/assets/js/14.15b994ed.js"><link rel="prefetch" href="/assets/js/15.e7d62da7.js"><link rel="prefetch" href="/assets/js/16.41425aa3.js"><link rel="prefetch" href="/assets/js/17.dc7889a9.js"><link rel="prefetch" href="/assets/js/18.7ea56f7e.js"><link rel="prefetch" href="/assets/js/19.5aeea5db.js"><link rel="prefetch" href="/assets/js/20.b2e072f0.js"><link rel="prefetch" href="/assets/js/21.5924bdf2.js"><link rel="prefetch" href="/assets/js/22.cf042521.js"><link rel="prefetch" href="/assets/js/23.f2ee7769.js"><link rel="prefetch" href="/assets/js/24.5bb33450.js"><link rel="prefetch" href="/assets/js/25.7452915d.js"><link rel="prefetch" href="/assets/js/26.7a90897c.js"><link rel="prefetch" href="/assets/js/27.8b918370.js"><link rel="prefetch" href="/assets/js/28.cef77b0d.js"><link rel="prefetch" href="/assets/js/29.112a9086.js"><link rel="prefetch" href="/assets/js/3.58e00342.js"><link rel="prefetch" href="/assets/js/30.04d4d50b.js"><link rel="prefetch" href="/assets/js/31.e07a0e82.js"><link rel="prefetch" href="/assets/js/32.b62a2be3.js"><link rel="prefetch" href="/assets/js/33.7dc6c043.js"><link rel="prefetch" href="/assets/js/34.25c9b37a.js"><link rel="prefetch" href="/assets/js/35.a3ab194c.js"><link rel="prefetch" href="/assets/js/36.2c23373a.js"><link rel="prefetch" href="/assets/js/37.54c005ef.js"><link rel="prefetch" href="/assets/js/38.94ee54fd.js"><link rel="prefetch" href="/assets/js/39.542c4dea.js"><link rel="prefetch" href="/assets/js/4.325b2889.js"><link rel="prefetch" href="/assets/js/40.75358810.js"><link rel="prefetch" href="/assets/js/41.fdfb67a4.js"><link rel="prefetch" href="/assets/js/42.9fbdfcc6.js"><link rel="prefetch" href="/assets/js/43.ea06eb5d.js"><link rel="prefetch" href="/assets/js/44.9a8209a3.js"><link rel="prefetch" href="/assets/js/45.dc43d89a.js"><link rel="prefetch" href="/assets/js/46.b481d9d5.js"><link rel="prefetch" href="/assets/js/47.a00f3f62.js"><link rel="prefetch" href="/assets/js/48.b6596210.js"><link rel="prefetch" href="/assets/js/49.2237f57f.js"><link rel="prefetch" href="/assets/js/5.942fd879.js"><link rel="prefetch" href="/assets/js/50.9bf499cc.js"><link rel="prefetch" href="/assets/js/51.83917165.js"><link rel="prefetch" href="/assets/js/53.da75e3f7.js"><link rel="prefetch" href="/assets/js/54.a0fa7f9b.js"><link rel="prefetch" href="/assets/js/55.027a0efd.js"><link rel="prefetch" href="/assets/js/56.5a2ed569.js"><link rel="prefetch" href="/assets/js/57.ecabee60.js"><link rel="prefetch" href="/assets/js/58.1c8eb019.js"><link rel="prefetch" href="/assets/js/59.b1e316bb.js"><link rel="prefetch" href="/assets/js/6.54e0f90a.js"><link rel="prefetch" href="/assets/js/60.bfa0e207.js"><link rel="prefetch" href="/assets/js/61.aac0012b.js"><link rel="prefetch" href="/assets/js/62.9537dafe.js"><link rel="prefetch" href="/assets/js/63.8c35fb96.js"><link rel="prefetch" href="/assets/js/64.d292e640.js"><link rel="prefetch" href="/assets/js/65.b49c87ee.js"><link rel="prefetch" href="/assets/js/66.779681a8.js"><link rel="prefetch" href="/assets/js/67.93ed162b.js"><link rel="prefetch" href="/assets/js/68.f77337a0.js"><link rel="prefetch" href="/assets/js/69.a1329256.js"><link rel="prefetch" href="/assets/js/7.af735ca0.js"><link rel="prefetch" href="/assets/js/70.b79ad3dd.js"><link rel="prefetch" href="/assets/js/71.947ecccf.js"><link rel="prefetch" href="/assets/js/72.e7182269.js"><link rel="prefetch" href="/assets/js/73.674a36a8.js"><link rel="prefetch" href="/assets/js/74.781b584b.js"><link rel="prefetch" href="/assets/js/75.3ce5b844.js"><link rel="prefetch" href="/assets/js/76.60ee4152.js"><link rel="prefetch" href="/assets/js/8.b92f87b7.js"><link rel="prefetch" href="/assets/js/9.858e5a21.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bc4b65ce.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/deepin.png" alt="Documentation" class="logo"> <span class="site-name can-hide">Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/pages/3fd76c/" class="nav-link">指南</a></div><div class="nav-item"><a href="/pages/45e05f/" class="nav-link">DTK</a></div><div class="nav-item"><a href="/pages/c15bcd/" class="nav-link">经验分享</a></div><div class="nav-item"><a href="/pages/6903df/" class="nav-link">社区作品</a></div><div class="nav-item"><a href="/pages/3b5851/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Translation" class="dropdown-title"><!----> <span class="title" style="display:;">Translation</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/pages/ebde83/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/linuxdeepin/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://raw.githubusercontent.com/xmuli/xmuliPic/pic/2020/DCIM.gif"> <div class="blogger-info"><h3>Deepin</h3> <span>Deepin 社区文档</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/pages/3fd76c/" class="nav-link">指南</a></div><div class="nav-item"><a href="/pages/45e05f/" class="nav-link">DTK</a></div><div class="nav-item"><a href="/pages/c15bcd/" class="nav-link">经验分享</a></div><div class="nav-item"><a href="/pages/6903df/" class="nav-link">社区作品</a></div><div class="nav-item"><a href="/pages/3b5851/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Translation" class="dropdown-title"><!----> <span class="title" style="display:;">Translation</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/pages/ebde83/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/linuxdeepin/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/6903df/" class="sidebar-link">READMEmd</a></li><li><a href="/pages/fb3f3a/" aria-current="page" class="active sidebar-link">dde-dock 开发网速插件 lfxSpeed</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#预览" class="sidebar-link">预览</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#编译" class="sidebar-link">编译</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#思路" class="sidebar-link">思路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#插件原理" class="sidebar-link">插件原理</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#lfxspeed-原理" class="sidebar-link">lfxSpeed 原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#获取系统参数" class="sidebar-link">获取系统参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#proc-介绍" class="sidebar-link">/proc 介绍</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#获取网速" class="sidebar-link">获取网速</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#获取cpu" class="sidebar-link">获取CPU</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#获取内存" class="sidebar-link">获取内存</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#获取系统运行时间" class="sidebar-link">获取系统运行时间</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#任务栏-1-2-2-的缺陷" class="sidebar-link">任务栏 1.2.2 的缺陷</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#下载地址" class="sidebar-link">下载地址：</a></li><li class="sidebar-sub-header"><a href="/pages/fb3f3a/#参考" class="sidebar-link">参考:</a></li></ul></li><li><a href="/pages/6a3365/" class="sidebar-link">Deepin 自定义修改窗口圆角大小</a></li><li><a href="/pages/fa806e/" class="sidebar-link">DTK 基础教程：自定义控件规范</a></li><li><a href="/pages/1acdc2/" class="sidebar-link">DTK常用和测试代码片</a></li><li><a href="/pages/3a0dcd/" class="sidebar-link">DTK的历史起源、发展，和简单入门(精华篇)</a></li><li><a href="/pages/2bcddd/" class="sidebar-link">基于lfxSpeed制作的infomation-tips</a></li><li><a href="/pages/82ea0c/" class="sidebar-link">DDE Store</a></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1b7c64bb><div class="articleInfo" data-v-1b7c64bb><ul class="breadcrumbs" data-v-1b7c64bb><li data-v-1b7c64bb><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1b7c64bb></a></li> <li data-v-1b7c64bb><span data-v-1b7c64bb>社区作品</span></li> <!----></ul> <div class="info" data-v-1b7c64bb><div title="作者" class="author iconfont icon-touxiang" data-v-1b7c64bb><a href="https://github.com/linuxdeepin" target="_blank" title="作者" class="beLink" data-v-1b7c64bb>Deepin | Any developer</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1b7c64bb><a href="javascript:;" data-v-1b7c64bb>2020-12-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          Deepin 开发任务栏网速插件 lfxSpeed
        </h1> <div class="theme-vdoing-content content__default"><p><strong>简  述：</strong>　在 <code>DDE</code> 桌面环境中开发 <code>dde-dock 插件</code> 项目实战： 网速插件 <code>lfxSpeed</code>；</p> <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/Peek%202020-12-04%2015-19.gif" width="50%"> <p>[TOC]</p> <br> <blockquote><p>文章来源：本文初发于 <strong>偕臧</strong> <a href="https://xmuli.tech/posts/c225b552/" target="_blank" rel="noopener noreferrer">https://xmuli.tech<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，同步转载于此。</p></blockquote> <br> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>因 <code>DDE</code>  属实漂亮，使用美观舒适，作为 <code>Deepin</code> 爱好者，习惯于在其它系统上有一个任务栏网速插件，但此 <code>Deepin v20 / UOS v20</code>上没有，于是便有了这个项目。适用于 <code>DDE</code> 的 <code>Linux</code> 发行版。</p> <br> <h2 id="预览"><a href="#预览" class="header-anchor">#</a> 预览</h2> <p><strong>已实现功能：</strong></p> <ul><li>实时显示网速、CPU 、内存使用率</li> <li>自定义网速精确度</li> <li>自定义修改标签</li> <li>自定义刷新时间</li> <li>显示或隐藏某一信息栏</li> <li>网速单位显示模式三种</li> <li>浅色 / 暗色 主题模式</li></ul> <p><strong>项目预览图：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20201204203142.png" width="50%"> <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20201204152635.png" width="35%"></p> <br> <h2 id="编译"><a href="#编译" class="header-anchor">#</a> 编译</h2> <p>开发环境 <strong>💻：</strong> <code>uos20</code> 📎 <code>Qt 5.11.3</code> 📎  <code>dde-dock = 5.2.0.24</code> 📎  <code>&quot;1.2.2&quot; 版本</code>；安装开发包，</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libdtkwidget-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> dde-dock-dev
</code></pre></div><p>下载 <a href="https://github.com/xmuli/lfxspeed" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 后，进入项目根目录，进行编译</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span> -j16
</code></pre></div><p>会生成一个 <code>liblfxSpeed.so</code> 共享库，在其路径下执行如下命令，若希望看到效果，需要执行 <code>killall dde-dock</code> 、<code>dde-dock</code> 后生效；</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">cp</span> liblfxSpeed.so /usr/lib/dde-dock/plugins     <span class="token comment"># 安装</span>
<span class="token function">sudo</span> <span class="token function">rm</span> -rf /usr/lib/dde-dock/plugins/liblfxSpeed.so <span class="token comment">#  卸载</span>
</code></pre></div><br> <h2 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h2> <h3 id="插件原理"><a href="#插件原理" class="header-anchor">#</a> 插件原理</h3> <p>项目最后生成一个动态库，原理是 <code>dde-dock</code> 使用了 <code>Qt5</code> 的插件机制，在运行时候加载动态库。</p> <p>有一篇 <code>Deepin</code> 官方出的教程，是隐藏 <code>dde-dock</code>项目之中 <a href="https://github.com/linuxdeepin/dde-dock/blob/master/plugins/plugin-guide/plugins-developer-guide.md" target="_blank" rel="noopener noreferrer">plugins-developer-guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 感觉成了一个小彩蛋；这篇文章对插件接口写的很详细，也有一个自带的小例子，讲解的很清晰；</p> <p><strong>主要工作就是，继承如下两个类：</strong></p> <ul><li><a href="https://github.com/linuxdeepin/dde-dock/blob/master/interfaces/pluginproxyinterface.h" target="_blank" rel="noopener noreferrer">pluginproxyinterface.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：可以主动去调用 dde-dock 的接口，用来管理 插件 的管理类</li> <li><a href="https://github.com/linuxdeepin/dde-dock/blob/master/interfaces/pluginsiteminterface.h" target="_blank" rel="noopener noreferrer">pluginsiteminterface.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ：被动的被 dock 调用</li></ul> <p>而自己新写的插件类，是必须同时继承两个类的：如 <code>class SpeedPlugin : public QObject, public PluginsItemInterface</code> 。实现一个最简单的插件类，重写下面前六个函数即可；若加更多功能，再重其它函数即可</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>    <span class="token comment">// 插件必须重写函数</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> QString <span class="token function">pluginName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>PluginProxyInterface <span class="token operator">*</span>proxyInter<span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> QWidget <span class="token operator">*</span><span class="token function">itemWidget</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>itemKey<span class="token punctuation">)</span> override<span class="token punctuation">;</span>

    <span class="token comment">// 插件禁用和启用相关的接口</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">pluginIsAllowDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">pluginIsDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">pluginStateSwitched</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override<span class="token punctuation">;</span>

    <span class="token comment">// 额外的功能：预览、右键菜单、悬浮显示</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> QString <span class="token function">pluginDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> QString <span class="token function">itemContextMenu</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>itemKey<span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">invokedMenuItem</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>itemKey<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>menuId<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> checked<span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> QWidget <span class="token operator">*</span><span class="token function">itemTipsWidget</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>itemKey<span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    
    <span class="token comment">// 更多其它...</span>
</code></pre></div><br> <h3 id="lfxspeed-原理"><a href="#lfxspeed-原理" class="header-anchor">#</a> lfxSpeed 原理</h3> <p>基本思路为 获取 <code>/proc</code> 文件，然后通过计算，转换单位等，只显示自己想要的结果；然后将其显示在控件布局之中，最后将整个控件显示在任务栏上（返回其对象的指针给 dock）；<strong>下面讲解如何从 <code>Linux</code> 通过 <code>/proc</code> 获取系统网速、CPU、Memory和运行时间等信息。</strong></p> <br> <h2 id="获取系统参数"><a href="#获取系统参数" class="header-anchor">#</a> 获取系统参数</h2> <h3 id="proc-介绍"><a href="#proc-介绍" class="header-anchor">#</a> <code>/proc</code> 介绍</h3> <p>Linux系统上的/proc目录是一种文件系统，即proc文件系统。与其它常见的文件系统不同的是，/proc是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，用户可以通过这些文件查看有关系统硬件及当前正在运行进程的信息，甚至可以通过更改其中某些文件来改变内核的运行状态。</p> <p>基于/proc文件系统如上所述的特殊性，其内的文件也常被称作虚拟文件，并具有一些独特的特点。例如，其中有些文件虽然使用查看命令查看时会返回大量信息，但文件本身的大小却会显示为0字节。此外，这些特殊文件中大多数文件的时间及日期属性通常为当前系统时间和日期，这跟它们随时会被刷新（存储于RAM中）有关。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 更多文件的获取，可以参考 https://zh.m.wikipedia.org/zh-cn/Procfs</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">PROC_PATH_UPTIME    </span><span class="token string">&quot;/proc/uptime&quot;</span>      <span class="token comment">// &quot;系统启动&quot; 和 &quot;系统空闲&quot; 的时间</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">PROC_PATH_CPU       </span><span class="token string">&quot;/proc/stat&quot;</span>        <span class="token comment">// &quot;CPU&quot; 使用率 的状态</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">PROC_PATH_MEM       </span><span class="token string">&quot;/proc/meminfo&quot;</span>     <span class="token comment">// &quot;内存&quot; 和 &quot;交换空间&quot; 的状态</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">PROC_PATH_NET       </span><span class="token string">&quot;/proc/net/dev&quot;</span>     <span class="token comment">// &quot;网速&quot; 下载和上传 的状态</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">PROC_PATH_DISK      </span><span class="token string">&quot;/proc/diskstats&quot;</span>   <span class="token comment">// &quot;磁盘&quot; 读取和写入 的状态</span></span>
</code></pre></div><br> <h3 id="获取网速"><a href="#获取网速" class="header-anchor">#</a> 获取网速</h3> <h4 id="读取文件"><a href="#读取文件" class="header-anchor">#</a> 读取文件</h4> <p>网络相关的数据，从 <code>/proc/net/dev</code>  文件获取：读取此文件进行计算即可<img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/image-20201117165447548.png" width="100%"></p> <p>这个文件每一行的详细含义如下：<strong>face: 接口</strong></p> <p>​	-------------------------------------【接收】-------------------------------------</p> <ol><li><p><code>bytes:</code> 接口接收的数据的总字节数</p></li> <li><p><code>packets:</code> 接口接收的数据包总数</p></li> <li><p><code>errs:</code> 由设备驱动程序检测到接收错误的总数</p></li> <li><p><code>drop:</code> 设备驱动程序丢弃的数据包总数</p></li> <li><p><code>fifo:</code> FIFO缓冲区错误的数量</p></li> <li><p><code>frame:</code> 分组帧错误的数量</p></li> <li><p><code>compressed:</code> 设备驱动程序接收的压缩数据包数</p></li> <li><p><code>multicast:</code> 设备驱动程序发送或接收的多播帧数</p> <p>-------------------------------------【传送】-------------------------------------</p></li> <li><p><code>bytes:</code>  接口发送的数据的总字节数</p></li> <li><p><code>packets:</code> 接口发送的数据包总数</p></li> <li><p><code>errs:</code> 由设备驱动程序检测到的发送错误的总数</p></li> <li><p><code>drop:</code> 同上</p></li> <li><p><code>fifo:</code> 同上</p></li> <li><p><code>colls:</code> 接口上检测到的冲突数</p></li> <li><p><code>carrier:</code> 由设备驱动程序检测到的载波损耗的数量</p></li> <li><p><code>compressed:</code> 设备驱动程序发送的压缩数据包数</p></li></ol> <p>需要注意的,，此处只是获取的为<strong>接口接收的数据的总字节数</strong> ，要获取实时速率，还得用起差值除以单位时间，才是网速。 <strong>其单位默认是字节</strong>。</p> <br> <h4 id="思路-2"><a href="#思路-2" class="header-anchor">#</a> 思路</h4> <p>此文件是<strong>某一时刻的</strong>，本机所有接收和发送的<strong>数据包总量</strong> ，其分别对应每一行的第 1 列、第 9 列 （byte 一列）；（注：第 0 列是前面的英文字符串）</p> <p>将每一行的的第 2 列累加，为此时可总的接收数据包（下载）；将每一行的的第 10 列加，为此时总的发送数据包（上传）；然后将两次时刻之差 除以时间间隔，就得到单位时间网速；</p> <br> <h4 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h4> <p>这里使用 <code>QRegExp(&quot;\\s{1,}&quot;)</code> 来分割，莫名会得到第一个切割为 <code>“”</code> 的字符串，所以对应的第 1和 9 列都要顺延加 1。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*!
 * \brief SpeedInfo::netRate 获取网某一时刻的网络总的数据包量
 * \param[out] netUpload 网络上传数据量
 * \param[out] netUpload 网络下载数据量
 */</span>
<span class="token keyword">void</span> <span class="token class-name">SpeedInfo</span><span class="token operator">::</span><span class="token function">netRate</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">&amp;</span>netDown<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>netUpload<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QFile <span class="token function">file</span><span class="token punctuation">(</span>PROC_PATH_NET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token operator">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 在读取时，把行尾结束符修改为 '\n'； 在写入时，把行尾结束符修改为本地系统换行风格，比如Windows文本换行是 &quot;\r\n&quot;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">&quot;\&quot;/proc/net/dev\&quot; don't open!&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">long</span> down <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> upload <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    QTextStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString line <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    line  <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    line  <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>line<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        QStringList list <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token function">QRegExp</span><span class="token punctuation">(</span><span class="token string">&quot;\\s{1,}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 匹配任意 大于等于1个的 空白字符</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            down <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            upload <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        netDown <span class="token operator">+=</span> down<span class="token punctuation">;</span>
        netUpload <span class="token operator">+=</span> upload<span class="token punctuation">;</span>
        line  <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <p>还需要将字节可以智能转换为对应的单位和对应的数值 的函数：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*!
 * \brief SpeedInfo::autoRateUnits 自动显示单位
 * \param[in] speed 传入的网速(无单位)
 * \param[out] unit 智能调节后的网速的单位
 * \param sensitive 速率单位的大小写模式
 * \return 自能调节单位后的速率
 */</span>
<span class="token keyword">double</span> <span class="token class-name">SpeedInfo</span><span class="token operator">::</span><span class="token function">autoRateUnits</span><span class="token punctuation">(</span><span class="token keyword">long</span> speed<span class="token punctuation">,</span> SpeedInfo<span class="token operator">::</span>RateUnit <span class="token operator">&amp;</span>unit<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* 自动判断合适的速率单位,默认传进来的是 Byte
     * bit    0 ~ 7 位 (不到 1 字节)
     * Byte   1    ~ 2^10  Byte
     * KB     2^10 ~ 2^20  Byte
     * MB     2^20 ~ 2^30  Byte
     * GB     2^30 ~ 2^40  Byte
     * TB     2^40 ~ 2^50  Byte
     */</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>unit <span class="token operator">!=</span> SpeedInfo<span class="token operator">::</span>RateByte<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">&quot;请先将单位转为字节(byte)后再传参&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> sp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> speed <span class="token operator">&amp;&amp;</span> speed <span class="token operator">&lt;</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        unit <span class="token operator">=</span> SpeedInfo<span class="token operator">::</span>RateByte<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> speed<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> speed <span class="token operator">&amp;&amp;</span> speed <span class="token operator">&lt;</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        unit <span class="token operator">=</span> SpeedInfo<span class="token operator">::</span>RateKb<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>speed <span class="token operator">/</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> speed <span class="token operator">&amp;&amp;</span> speed <span class="token operator">&lt;</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        unit <span class="token operator">=</span> SpeedInfo<span class="token operator">::</span>RateMb<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>speed <span class="token operator">/</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> speed <span class="token operator">&amp;&amp;</span> speed <span class="token operator">&lt;</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        unit <span class="token operator">=</span> SpeedInfo<span class="token operator">::</span>RateGb<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>speed <span class="token operator">/</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> speed <span class="token operator">&amp;&amp;</span> speed <span class="token operator">&lt;</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        unit <span class="token operator">=</span> SpeedInfo<span class="token operator">::</span>RateTb<span class="token punctuation">;</span>
        sp <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>speed <span class="token operator">/</span> <span class="token function">qPow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        unit <span class="token operator">=</span> SpeedInfo<span class="token operator">::</span>RateUnknow<span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">&quot;本设备网络速率单位传输超过 TB, 或者低于 0 Byte.&quot;</span><span class="token punctuation">;</span>
        sp <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> sp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h3 id="获取cpu"><a href="#获取cpu" class="header-anchor">#</a> 获取CPU</h3> <h4 id="读取文件-2"><a href="#读取文件-2" class="header-anchor">#</a> 读取文件</h4> <p><code>CPU</code> 相关的数据，从 <code>/proc/stat</code>  文件获取：读取此文件进行计算即可</p> <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20201202110836.png" width="100%"> <p><strong>这个文件上面每一列表的详细含义如下:</strong></p> <ol><li><code>user:</code> 用户态时间（一般/高优先级，仅统计nice&lt;=0）</li> <li><code>nice:</code> 用户态时间（低优先级，nice&gt;0）</li> <li><code>system:</code>  内核态时间</li> <li><code>idle:</code> 空闲时间（ 不包含IO等待时间）</li> <li><code>iowait:</code>  I/O等待时间 （ 硬盘IO等待时间）</li> <li><code>irq:</code> 硬中断</li> <li><code>softirq:</code>  软中断</li> <li><code>steal:</code>  被盗时间（虚拟化环境中运行其他操作系统上花费的时间（since Linux 2.6.11））</li> <li><code>guest:</code>  来宾时间（操作系统运行虚拟CPU花费的时间（since Linux 2.6.24））</li> <li><code>guest_nice:</code> nice 来宾时间（ 运行一个带nice值的guest花费的时间（since Linux 2.6.33））</li></ol> <br> <p><strong>最后的几个数值含义：</strong></p> <ol><li><code>intr：</code> 系统启动以来的所有interrupts的次数情况（有冗余信息）；这行给出中断的信息，第一个为自系统启动以来，发生的所有的中断的次数。然后每个数对应一个特定的中断自系统启动以来所发生的次数。</li> <li><code>ctxt:</code>  自系统启动以来CPU发生的上下文交换的次数</li> <li><code>btime：</code> 启动时长(单位:秒)，从Epoch(即1970零时)开始到系统启动所经过的时长，每次启动会改变。</li> <li><code>processes</code>：自系统启动以来所创建的任务的个数目。当短时间该值特别大，系统可能出现异常</li> <li><code>procs_running：</code> 当前运行队列的任务的数目</li> <li><code>procs_blocked：</code> 当前被阻塞的任务的数目</li> <li><code>softirq:</code>  此行显示所有CPU的softirq总数, 第一列是所有软件和每个软件的总数, 后面的列是特定softirq的总数</li></ol> <p><strong>其单位为 <code>jiffies</code>；其中 <code>1 jiffies = 0.01s = 10ms</code></strong></p> <br> <h4 id="思路-3"><a href="#思路-3" class="header-anchor">#</a> 思路</h4> <p>和我们相关暂时只关心第一行，每次读取，依旧<strong>是某一时刻状态</strong> ，CPU 总量 cpuAll 为第一行所有列之和，空闲量 cpuFree 为第一行的第 4 列。将 <code>（cpuAll - cpuFree） / cpuAll</code> 就是此时刻的 CPU 使用率。</p> <p>而 <code>(((cpuAll - old_cpuAll) - (cpuFree - old_cpuFree)) * 100.0 / (cpuAll - old_cpuAll)</code> 则是CPU 在<strong>某一单位时间段</strong> 的 CPU 使用率。</p> <br> <h4 id="代码-2"><a href="#代码-2" class="header-anchor">#</a> 代码</h4> <p>获取某一时刻 CPU 的总量和空闲量</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*!
 * \brief SpeedInfo::cpuRate 获取某一次 CPU 的使用情况
 * \param[out] cpuAll 总 cpu 使用量
 * \param[out] cpuFree 空闲 cpu 的使用量
 */</span>
<span class="token keyword">void</span> <span class="token class-name">SpeedInfo</span><span class="token operator">::</span><span class="token function">cpuRate</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">&amp;</span>cpuAll<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>cpuFree<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    cpuAll <span class="token operator">=</span> cpuFree <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> ok <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    QFile <span class="token function">file</span><span class="token punctuation">(</span>PROC_PATH_CPU<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token operator">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    QTextStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString line <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>line<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        QStringList list <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token function">QRegExp</span><span class="token punctuation">(</span><span class="token string">&quot;\\s{1,}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> v <span class="token operator">!=</span> list<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>v<span class="token punctuation">)</span>
            cpuAll <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token operator">*</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cpuFree <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h3 id="获取内存"><a href="#获取内存" class="header-anchor">#</a> 获取内存</h3> <h4 id="读取文件-3"><a href="#读取文件-3" class="header-anchor">#</a> 读取文件</h4> <p><code>Memory</code> 相关的数据，从 <code>/proc/meminfo</code>  文件获取：读取此文件进行计算即可</p> <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20201202132456.png" width="40%"> <p>此文件的详细解释：</p> <ol><li><p><code>MemTotal:</code> 所有内存(RAM)大小,减去一些预留空间和内核的大小。</p></li> <li><p><code>MemFree:</code> 完全没有用到的物理内存，lowFree+highFree</p></li> <li><p><code>MemAvailable:</code> 在不使用交换空间的情况下，启动一个新的应用最大可用内存的大小，计算方式：MemFree+Active(file)+Inactive(file)-(watermark+min(watermark,Active(file)+Inactive(file)/2))</p></li> <li><p><code>Buffers:</code> 块设备所占用的缓存页，包括：直接读写块设备以及文件系统元数据(metadata)，比如superblock使用的缓存页。</p></li> <li><p><code>Cached:</code> 表示普通文件数据所占用的缓存页。</p></li> <li><p><code>SwapCached:</code> swap cache中包含的是被确定要swapping换页，但是尚未写入物理交换区的匿名内存页。那些匿名内存页，比如用户进程malloc申请的内存页是没有关联任何文件的，如果发生swapping换页，这类内存会被写入到交换区。</p></li> <li><p><code>Active:</code> active包含active anon和active file</p></li> <li><p><code>Inactive:</code> inactive包含inactive anon和inactive file</p></li> <li><p><code>Active(anon):</code> anonymous pages（匿名页），用户进程的内存页分为两种：与文件关联的内存页(比如程序文件,数据文件对应的内存页)和与内存无关的内存页（比如进程的堆栈，用malloc申请的内存），前者称为file pages或mapped pages,后者称为匿名页。</p></li> <li><p><code>Inactive(anon):</code> 见上</p></li> <li><p><code>Active(file):</code> 见上</p></li> <li><p><code>Inactive(file):</code> 见上</p></li> <li><p><code>SwapTotal:</code> 可用的swap空间的总的大小(swap分区在物理内存不够的情况下，把硬盘空间的一部分释放出来，以供当前程序使用)</p></li> <li><p><code>SwapFree:</code> 当前剩余的swap的大小</p></li> <li><p><code>Dirty:</code> 需要写入磁盘的内存去的大小<code>Writeback:</code> 正在被写回的内存区的大小<code>AnonPages:</code> 未映射页的内存的大小<code>Mapped:</code> 设备和文件等映射的大小</p></li> <li><p><code>Slab:</code> 内核数据结构slab的大小</p></li> <li><p><code>SReclaimable:</code> 可回收的slab的大小</p></li> <li><p><code>SUnreclaim:</code> 不可回收的slab的大小</p></li> <li><p><code>PageTables:</code> 管理内存页页面的大小</p></li> <li><p><code>NFS_Unstable:</code> 不稳定页表的大小</p></li> <li><p><code>VmallocTotal:</code> Vmalloc内存区的大小</p></li> <li><p><code>VmallocUsed:</code> 已用Vmalloc内存区的大小</p></li> <li><p><code>VmallocChunk:</code> vmalloc区可用的连续最大快的大小</p></li></ol> <h4 id="思路-4"><a href="#思路-4" class="header-anchor">#</a> 思路</h4> <p>此为某一时刻系统的内存和交换空间使用情况的截图；</p> <p><strong>对于内存：</strong> 内存总量 memoryAll 为 MemTotal 的数值，空闲内存 memoryFree 为 MemAvailable 的数值，使用中的内存为 memoryUse 为 （MemTotal - MemAvailable）；</p> <p><strong>对于交换空间：</strong> 交换空间总量 swapAll 为 SwapTotal 数值，空闲交换空间 swapFree 为 SwapFree 数值，使用中的交换控件量为 swapUse 为 （SwapTotal -  SwapFree） 数值；</p> <h4 id="代码-3"><a href="#代码-3" class="header-anchor">#</a> 代码</h4> <p>获取某一时刻内存核交换空间的使用情况，但是这里所有单位都是 字节；</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*!
 * \brief SpeedInfo::memoryRate 获取 “内存” 和 “交换空间” 的某一时刻的使用情况
 * \param memory 内存使用量
 * \param memoryAll 内存总量
 * \param swap 交换空间使用量
 * \param swapAll 交换空间总量
 */</span>
<span class="token keyword">void</span> <span class="token class-name">SpeedInfo</span><span class="token operator">::</span><span class="token function">memoryRate</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">&amp;</span>memory<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>memoryAll<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>swap<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>swapAll<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    memory <span class="token operator">=</span> memoryAll <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    swap <span class="token operator">=</span> swapAll <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> ok <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    QFile <span class="token function">file</span><span class="token punctuation">(</span>PROC_PATH_MEM<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token operator">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    QTextStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> buff<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        QString line <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QStringList list <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token function">QRegExp</span><span class="token punctuation">(</span><span class="token string">&quot;\\s{1,}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ok<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    memoryAll <span class="token operator">=</span> buff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    memory <span class="token operator">=</span> buff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> buff<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    swapAll <span class="token operator">=</span> buff<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    swap <span class="token operator">=</span> buff<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">-</span> buff<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h3 id="获取系统运行时间"><a href="#获取系统运行时间" class="header-anchor">#</a> 获取系统运行时间</h3> <h4 id="读取文件-4"><a href="#读取文件-4" class="header-anchor">#</a> 读取文件</h4> <p>想在预览里面显示系统开机到现在的运行时间。读取文件为 <code>/proc/uptime</code> ，</p> <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20201202140839.png" width="40%"> <p>文件一共的两列表含义为：</p> <ol><li>系统启动到现在的时间（以秒为单位）</li> <li>系统空闲的时间（以秒为单位）</li></ol> <h4 id="思路-5"><a href="#思路-5" class="header-anchor">#</a> 思路</h4> <p>将第一个参数获取获取，然后将这个数值转换为  <strong>“ x 天， hh:MM:ss”</strong>  的格式，这是我想显示的格式。</p> <h4 id="代码-4"><a href="#代码-4" class="header-anchor">#</a> 代码</h4> <p>获取系统开始到现在的运行时间，单位为 秒；</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token class-name">SpeedInfo</span><span class="token operator">::</span><span class="token function">uptime</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>run<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>idle<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    run <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    idle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    QFile <span class="token function">file</span><span class="token punctuation">(</span>PROC_PATH_UPTIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly <span class="token operator">|</span> QIODevice<span class="token operator">::</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">&quot;\&quot;/proc/uptime\&quot; don't open!&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    QTextStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString line <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QStringList list <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token function">QRegExp</span><span class="token punctuation">(</span><span class="token string">&quot;\\s{1,}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        run <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        idle <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里本以为个很容易有现成的 <code>QDateTime</code> 之类的，直接将 秒 转换为想要的时间格式，试了一圈，发现没有，有一个很接近，但是以 1970 零时为开始的，也不符合预期。娜娜的无奈，还是自己动手写吧～</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>QString <span class="token class-name">SpeedInfo</span><span class="token operator">::</span><span class="token function">autoTimeUnits</span><span class="token punctuation">(</span><span class="token keyword">double</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> time <span class="token operator">=</span> <span class="token function">qFloor</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ss <span class="token operator">=</span> time <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> MM <span class="token operator">=</span> <span class="token punctuation">(</span>time <span class="token operator">%</span> <span class="token number">3600</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> hh <span class="token operator">=</span> <span class="token punctuation">(</span>time <span class="token operator">%</span> <span class="token number">86400</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> dd <span class="token operator">=</span> time <span class="token operator">/</span> <span class="token number">86400</span><span class="token punctuation">;</span>

    QString runTime <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token function">tr</span><span class="token punctuation">(</span><span class="token string">&quot;系统已运行: %1天, %2:%3:%4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>dd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">QLatin1Char</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>hh<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">QLatin1Char</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>MM<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">QLatin1Char</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">QLatin1Char</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> runTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <h2 id="任务栏-1-2-2-的缺陷"><a href="#任务栏-1-2-2-的缺陷" class="header-anchor">#</a> 任务栏 <code>1.2.2</code> 的缺陷</h2> <p>开发过程中，又遇到一些如下 dde-dock 的一些 bug：</p> <ol><li><p><strong>插件真实大小只有 图标范围</strong></p> <p>这里指的是，无论插件在 dock 布局上，显示有多大，但实际大小都只有如下中间的一个图标大小，右键非红色区域没有响应；</p> <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20201204195032.png" width="30%"></li> <li><p><strong>叫非 <code>datetime</code> 的插件显示都会被压缩</strong></p> <p>如果返回的插件名称为非 <code>datetime</code>， 且任务栏高度过低的时候，会出现内容上下被遮盖，显示不全。原因分析参见 <a href="https://github.com/linuxdeepin/dde-dock/issues/321" target="_blank" rel="noopener noreferrer">#321<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> （基于 <code>1.2.2</code>）；另外在 <a href="https://github.com/linuxdeepin/dde-dock/commit/9188fff15bdac20edbd14290bb1e44c1bcef28b5" target="_blank" rel="noopener noreferrer">9188fff1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 已经修复（基于 <code>1.2.3</code> ）。补丁暂只提交到 uos 分支，当前开发分支暂时未升级。</p></li> <li><p><strong>修改布局不会自动刷新</strong></p> <p>当我调整的插件布局时候，好像不会<strong>立刻</strong> 通知到 dock 重新布局，也没有信号重新通知任务栏。也有可能室友，但是我没有找到？？？或如果有更好的解决方案，可以分享一波？？？临时的解决方案是，①将布局大小写死 ②手动刷新（卸载此插件后立刻重新加载此插件）。</p></li></ol> <br> <h2 id="下载地址"><a href="#下载地址" class="header-anchor">#</a> 下载地址：</h2> <p><a href="https://github.com/xmuli/lfxspeed" target="_blank" rel="noopener noreferrer">lfxspeed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <br> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考:</h2> <ul><li><a href="https://github.com/linuxdeepin/dde-dock/blob/master/plugins/plugin-guide/plugins-developer-guide.md" target="_blank" rel="noopener noreferrer">plugins-developer-guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/deb0ed35c1c2" target="_blank" rel="noopener noreferrer">深度系统监视器原理剖析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://gityuan.com/2017/08/12/proc_stat/" target="_blank" rel="noopener noreferrer">/proc/stat解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://smilejay.com/2012/05/proc_uptime/" target="_blank" rel="noopener noreferrer">/PROC/UPTIME详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/liushui-sky/p/9236007.html" target="_blank" rel="noopener noreferrer">Linux平台Cpu使用率的计算<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/sonichy/CMDU_DDE_DOCK" target="_blank" rel="noopener noreferrer">CMDU_DDE_DOCK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/v-svg/dde-dock-netspeed" target="_blank" rel="noopener noreferrer">dde-dock-netspeed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/zhongyang219/TrafficMonitor" target="_blank" rel="noopener noreferrer">TrafficMonitor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://stackoverflow.com/questions/3521678/what-are-meanings-of-fields-in-proc-net-dev" target="_blank" rel="noopener noreferrer">What are meanings of fields in /proc/net/dev?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/linuxdeepin/docs/edit/master/docs/03.社区作品/01.dde-dock 开发网速插件 lfxSpeed.md" target="_blank" rel="noopener noreferrer">帮助编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/17/2020, 2:19:01 AM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/6903df/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">READMEmd</div></a> <a href="/pages/6a3365/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Deepin 自定义修改窗口圆角大小</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/6903df/" class="prev">READMEmd</a></span> <span class="next"><a href="/pages/6a3365/">Deepin 自定义修改窗口圆角大小</a>→
      </span></p></div></div></div> <!----> </main></div> <div class="footer"><div class="icons"><a href="mailto:github@uniontech.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/linuxdeepin/docs" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2020
    <span>Deepin | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fc02f5f4.js" defer></script><script src="/assets/js/2.ed4cc2e0.js" defer></script><script src="/assets/js/52.9884a8fd.js" defer></script>
  </body>
</html>